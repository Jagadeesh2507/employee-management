<div class="employee-container bg-light p-4 rounded shadow position-relative">

  <!-- ⭐ NOTIFICATION BELL (Top Right, DOES NOT MERGE) ⭐ -->
  <div class="notification-wrapper">
    <app-notification-bell *ngIf="userRole.toLowerCase() === 'admin'"></app-notification-bell>
  </div>

  <!-- ⭐ TOP BAR (Dashboard + Title + Logout) ⭐ -->
  <div class="row align-items-center top-header">

    <!-- Dashboard (Admin Only) -->
    <!-- <div class="col-12 col-md-3 mb-2 mb-md-0 text-md-start"
        >
      <a routerLink="/app-dashboard"
         class="btn btn-outline-primary d-flex align-items-center justify-content-center gap-2 dashboard-btn">
        <i class="bi bi-grid-fill fs-5"></i> Dashboard
      </a>
    </div> -->
    <div class="col-12 col-md-3 mb-2 mb-md-0 text-md-start"  *ngIf="userRole.toLowerCase() === 'admin'">
    <a [routerLink]="['/app-dashboard']"
       class="btn btn-outline-primary d-inline-flex align-items-center gap-2 shadow"
       style="border-radius: 50px; padding: 0.5rem 1rem;">
      <i class="bi bi-grid-fill fs-5"></i>
      <span class="d-none d-md-inline">Dashboard</span>
    </a>
  </div>

    <!-- Centered Title -->
    <div class="col-12 col-md-6 mb-3 mb-md-0 text-center">
      <h3 class="fw-bold mb-0 title-text">
        {{ userRole.toLowerCase() === 'admin'
          ? 'Employee Management'
          : 'Employee Details (Read-Only)' }}
      </h3>
    </div>

    <!-- User + Logout -->
    <div class="col-12 col-md-3 text-center text-md-end">
      <div *ngIf="user" class="d-inline-flex align-items-center gap-2">
    <span class="welcome-text">Welcome, <strong>{{ user }}</strong></span>
    <button class="btn btn-primary logout-btn" (click)="logout()">Logout</button>
  </div>

    </div>

  </div>

  <hr class="mt-3 mb-4">

  <!-- ⭐ FULL EMPLOYEE FORM ⭐ -->
  <form (ngSubmit)="onSubmit()" #employeeForm="ngForm" autocomplete="off" novalidate>

    <!-- Employee Name -->
   <div class="row mb-3">
  <label class="col-sm-3 col-form-label">Employee Name <span class="text-danger">*</span></label>
  <div class="col-sm-7">
    
    <input type="text" class="form-control"
           [(ngModel)]="employee.name" name="name"
           required minlength="3"
           #name="ngModel"
           [disabled]="!isAdmin"
           [class.is-invalid]="name.invalid && (name.dirty || name.touched)">

    <div class="invalid-feedback" *ngIf="name.invalid && (name.dirty || name.touched)">
      <small *ngIf="name.errors?.['required']">Employee Name is required.</small>
      <small *ngIf="name.errors?.['minlength']">Minimum 3 characters required.</small>
    </div>

  </div>

  <!-- Search Button -->
  <div class="col-12 col-sm-2 mt-2 mt-sm-0 text-sm-end" *ngIf="isAdmin">
     <button type="button" class="btn-clear" data-bs-toggle="modal" data-bs-target="#searchModal"> 
      <i class="fa fa-search" style="font-size: 24px; color:#6c757d"></i>
       <img src="assets/search-icon.png" alt="search-icon" style="width: 30px; height: 32px; margin-left: -2px; margin-top: -1px; vertical-align: middle;"> 
      </button> 
    </div>
</div>

    <div class="modal fade" id="searchModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">

      <!-- Header -->
      <div class="modal-header">
        <h5 class="modal-title">Search Employee</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <!-- Body -->
      <div class="modal-body">

        <!-- Search Input -->
        <div class="d-flex mb-3 align-items-center">
          <input
            type="text"
            class="form-control me-2"
            placeholder="Type first 3 letters"
            [(ngModel)]="searchname"
            name="searchname"
          />
          <button type="button" class="btn btn-primary" (click)="onSearch()">
            Search
          </button>
        </div>

        <!-- Results -->
        <ul class="list-group">
          <li
            *ngFor="let emp of searchResults"
            class="list-group-item list-group-item-action"
            (click)="selectEmployee(emp)"
          >
            {{ emp.name }}
          </li>
        </ul>

        <!-- No Records Found Message -->
        <div
          *ngIf="noRecordsFoundMessage"
          style="color: blue; margin-top: 10px; text-align: center;"
        >
          {{ noRecordsFoundMessage }}
        </div>

      </div>
    </div>
  </div>
</div>

    <!-- Designation -->
    <div class="row mb-3">
      <label class="col-sm-3 col-form-label">Designation<span class="required">*</span></label>
      <div class="col-sm-9">
        <select class="form-select"
        [(ngModel)]="employee.designation" name="designation"
        required #designation="ngModel"
        [disabled]="!isAdmin"
        [class.is-invalid]="designation.invalid && (designation.dirty || designation.touched)">
  <option value="">Select</option>
  <option value="Developer">Developer</option>
  <option value="Tester">Tester</option>
  <option value="Manager">Manager</option>
</select>

<div class="invalid-feedback" *ngIf="designation.invalid && (designation.dirty || designation.touched)">
  Designation is required.
</div>
      </div>
    </div>

    <!-- Gender -->
    <div class="row mb-3">
      <label class="col-sm-3 col-form-label">Gender<span class="required">*</span></label>
      <div class="col-sm-9">
        <div class="form-check form-check-inline">
  <input class="form-check-input"
         type="radio"
         name="gender"
         [(ngModel)]="employee.gender"
         value="Male"
         required #gender="ngModel"
         [disabled]="!isAdmin">
  <label class="form-check-label">Male</label>
</div>

<div class="form-check form-check-inline">
  <input class="form-check-input"
         type="radio"
         name="gender"
         [(ngModel)]="employee.gender"
         value="Female"
         required
         [disabled]="!isAdmin">
  <label class="form-check-label">Female</label>
</div>

<div class="invalid-feedback" *ngIf="gender.invalid && (gender.dirty || gender.touched)">
  Gender is required.
</div>
      </div>
    </div>

    <!-- Skills -->
    <div class="row mb-3">
      <label class="col-sm-3 col-form-label">Skills<span class="required">*</span></label>
      <div class="col-sm-9">

        <input type="text" class="form-control"
               placeholder="Enter skill and press Enter"
               [(ngModel)]="skillInput" name="skillInput"
               (keydown.enter)="addSkill(skillInput)" 
               (input)="onSkillInputChange()"
               [disabled]="!isAdmin">

        <!-- Suggestions -->
        <ul *ngIf="filteredSkills.length && isAdmin"
            class="list-group shadow mt-1">
          <li class="list-group-item list-group-item-action"
              *ngFor="let s of filteredSkills"
              (click)="addSkill(s)">{{ s }}</li>
        </ul>

        <!-- Added Skills -->
        <div class="mt-2">
          <span *ngFor="let s of employee.skillsArray"
                class="badge bg-primary me-1 p-2">
            {{ s }}
            <button class="btn-close btn-close-white ms-1"
                    type="button"
                    (click)="removeSkill(s)"
                    [disabled]="!isAdmin"></button>
          </span>
        </div>
      </div>
    </div>

    <!-- Phone Number -->
    <div class="row mb-3">
      <label class="col-sm-3 col-form-label">Phone<span class="required">*</span></label>
      <div class="col-sm-9">
       <input type="text" class="form-control"
       [(ngModel)]="employee.phoneNumber" name="phoneNumber"
       required pattern="[0-9]{10}"
       maxlength="10" #phone="ngModel"
       [disabled]="!isAdmin"
       (keypress)="allowOnlyNumbers($event)"
       [class.is-invalid]="phone.invalid && (phone.dirty || phone.touched)">

<div class="invalid-feedback" *ngIf="phone.invalid && (phone.dirty || phone.touched)">
  <small *ngIf="phone.errors?.['required']">Phone number is required.</small>
  <small *ngIf="phone.errors?.['pattern']">Must be a valid 10-digit phone number.</small>
</div>
      </div>
    </div>

    <!-- Email -->
    <div class="row mb-3">
      <label class="col-sm-3 col-form-label">Email<span class="required">*</span></label>
      <div class="col-sm-9">
       <input type="email" class="form-control"
       [(ngModel)]="employee.email" name="email"
       required email #emailCtrl="ngModel"
       [disabled]="!isAdmin"
       [class.is-invalid]="emailCtrl.invalid && (emailCtrl.dirty || emailCtrl.touched)">

<div class="invalid-feedback" *ngIf="emailCtrl.invalid && (emailCtrl.dirty || emailCtrl.touched)">
  <small *ngIf="emailCtrl.errors?.['required']">Email is required.</small>
  <small *ngIf="emailCtrl.errors?.['email']">Invalid email format.</small>
</div>
      </div>
    </div>

    <!-- Date Of Joining -->
    <div class="row mb-3">
      <label class="col-sm-3 col-form-label">Date of Joining<span class="required">*</span></label>
      <div class="col-sm-9">
       <input type="date" class="form-control"
       [(ngModel)]="employee.dateofjoining" name="dateofjoining"
       required [max]="maxDateForJoining"
       #doj="ngModel" [disabled]="!isAdmin"
       [class.is-invalid]="doj.invalid && (doj.dirty || doj.touched)">

<div class="invalid-feedback" *ngIf="doj.invalid && (doj.dirty || doj.touched)">
  Date of Joining is required.
</div>
      </div>
    </div>

    <!-- Bank Account -->
    <div class="row mb-3">
      <label class="col-sm-3 col-form-label">Has Bank A/c?<span class="required">*</span></label>
      <div class="col-sm-9">
        <div class="form-check form-check-inline">
          <input type="radio" class="form-check-input"
                 name="hasBankAccount" [(ngModel)]="employee.hasBankAccount"
                 [value]="true" required [disabled]="!isAdmin"/>
          <label class="form-check-label">Yes</label>
        </div>
        <div class="form-check form-check-inline">
          <input type="radio" class="form-check-input"
                 name="hasBankAccount" [(ngModel)]="employee.hasBankAccount"
                 [value]="false" required [disabled]="!isAdmin"/>
          <label class="form-check-label">No</label>
        </div>
      </div>
    </div>

    <!-- Bank Details -->
    <div *ngIf="employee.hasBankAccount" class="bank-box">

      <h5 class="fw-bold mb-3">Bank Account Details</h5>

      <!-- Bank Name -->
      <div class="row mb-3">
        <label class="col-sm-3 col-form-label">Bank Name<span class="required">*</span></label>
        <div class="col-sm-9">
          <input type="text" class="form-control"
                 [(ngModel)]="employee.bankName" name="bankName" required
                 [disabled]="!isAdmin"/>
        </div>
      </div>

      <!-- Account Number -->
      <div class="row mb-3">
        <label class="col-sm-3 col-form-label">Account No<span class="required">*</span></label>
        <div class="col-sm-9">
         <input type="text" class="form-control"
       [(ngModel)]="employee.accountNumber" name="accountNumber"
       required pattern="[0-9]{9,18}"
       #acct="ngModel"
       [disabled]="!isAdmin"
       [class.is-invalid]="acct.invalid && (acct.dirty || acct.touched)">

<div class="invalid-feedback" *ngIf="acct.invalid && (acct.dirty || acct.touched)">
  <small *ngIf="acct.errors?.['required']">Account Number is required.</small>
  <small *ngIf="acct.errors?.['pattern']">Must be 9–18 digits.</small>
</div>
        </div>
      </div>

    </div>

    <!-- Username -->
    <div class="row mb-3">
      <label class="col-sm-3 col-form-label">Username<span class="required">*</span></label>
      <div class="col-sm-9">
        <input type="text" class="form-control"
       [(ngModel)]="employee.username" name="username"
       required minlength="4"
       #uname="ngModel"
       [disabled]="usernameDisabled || !isAdmin"
       [class.is-invalid]="uname.invalid && (uname.dirty || uname.touched)">

<div class="invalid-feedback" *ngIf="uname.invalid && (uname.dirty || uname.touched)">
  <small *ngIf="uname.errors?.['required']">Username is required.</small>
  <small *ngIf="uname.errors?.['minlength']">Minimum 4 characters.</small>
</div>
      </div>
    </div>

    <!-- Password -->
    <div class="row mb-3">
      <label class="col-sm-3 col-form-label">Password<span class="required">*</span></label>
      <div class="col-sm-9">
       <input type="password" class="form-control"
       [(ngModel)]="employee.password" name="password"
       required minlength="6"
       #pwd="ngModel"
       [disabled]="!isAdmin"
       [class.is-invalid]="pwd.invalid && (pwd.dirty || pwd.touched)">

<div class="invalid-feedback" *ngIf="pwd.invalid && (pwd.dirty || pwd.touched)">
  <small *ngIf="pwd.errors?.['required']">Password is required.</small>
  <small *ngIf="pwd.errors?.['minlength']">Minimum 6 characters.</small>
</div>
      </div>
    </div>

    <!-- Role -->
    <div class="row mb-4">
      <label class="col-sm-3 col-form-label">Role<span class="required">*</span></label>
      <div class="col-sm-9">
        <select class="form-select"
        [(ngModel)]="employee.selectedRole" name="role"
        required #roleCtrl="ngModel"
        [disabled]="!isAdmin"
        [class.is-invalid]="roleCtrl.invalid && (roleCtrl.dirty || roleCtrl.touched)">
  <option value="">Select Role</option>
  <option value="Admin">Admin</option>
  <option value="Employee">Employee</option>
</select>

<div class="invalid-feedback" *ngIf="roleCtrl.invalid && (roleCtrl.dirty || roleCtrl.touched)">
  Role is required.
</div>
      </div>
    </div>

    <!-- SUBMIT + RESET -->
    <div class="text-center mb-4" *ngIf="isAdmin">
      <button type="submit" class="btn btn-primary me-2">Submit</button>
      <button type="button" class="btn btn-secondary ms-2" (click)="onReset()">Reset</button>
    </div>

  </form>

  <!-- ⭐ EMPLOYEE LIST (ADMIN ONLY) ⭐ -->
  <div *ngIf="isAdmin" class="employee-list-section mt-5">
    <h4 class="fw-bold mb-3">Employee List</h4>

    <!-- Page Size -->
    <div class="row mb-3">
      <label class="col-sm-1 col-form-label">Count</label>
      <div class="col-sm-2">
        <select class="form-select form-select-sm"
                [(ngModel)]="pageSize" (change)="onPageSizeChange($event)">
          <option>3</option>
          <option>5</option>
          <option>10</option>
          <option>20</option>
        </select>
      </div>
    </div>

    <!-- LIST TABLE -->
    <div class="list-box p-3 rounded shadow bg-white">

      <!-- Header -->
      <div class="row fw-bold border-bottom pb-2 mb-2">
        <div class="col-1">#</div>
        <div class="col-3">Name</div>
        <div class="col-3">DOJ</div>
        <div class="col-3">Action</div>
        <div class="col-2">Delete</div>
      </div>

      <!-- Rows -->
      <div *ngFor="let emp of paginatedEmployees; let i = index"
           class="row py-2 border-bottom align-items-center">
        <div class="col-1">{{ (currentPage - 1) * pageSize + i + 1 }}</div>
        <div class="col-3">{{ emp.name }}</div>
        <div class="col-3">{{ emp.dateofJoining | date:'yyyy-MM-dd' }}</div>
        <div class="col-3">
          <button class="btn btn-link p-0" (click)="selectEmployee(emp)">View/Edit</button>
        </div>
        <div class="col-2">
          <button class="btn btn-danger btn-sm"
                  (click)="confirmDelete(emp.id)">Delete</button>
        </div>
      </div>

    </div>

    <!-- Pagination -->
    <div class="d-flex justify-content-end mt-3">
      <ul class="pagination">
        <li class="page-item" [class.disabled]="currentPage === 1">
          <a class="page-link" (click)="changePage(currentPage - 1)">Previous</a>
        </li>

        <li *ngFor="let page of getPages()" class="page-item" [class.active]="page === currentPage">
          <a class="page-link" (click)="changePage(page)">{{ page }}</a>
        </li>

        <li class="page-item" [class.disabled]="currentPage === totalPages">
          <a class="page-link" (click)="changePage(currentPage + 1)">Next</a>
        </li>
      </ul>
    </div>

    <!-- Download Options -->
    <div class="mt-3">
      <button class="btn btn-success dropdown-toggle"
              id="downloadDropdown" data-bs-toggle="dropdown">
        Download Options
      </button>

      <ul class="dropdown-menu">
        <li><a class="dropdown-item" (click)="downloadExcel()">Excel</a></li>
        <li><a class="dropdown-item" (click)="downloadPdf()">PDF</a></li>
      </ul>
    </div>

  </div>

</div>
